MOSS SpNavigationNode.Children always empty
sharepoint navigation
I'm trying to return all the child nodes of a set of navigation nodes in sharepoint, the SDK implies I should be doing something like this:
NodeColl = objSite.Navigation.TopNavigationBar 
Dim Node as SPNavigationNode

For Each Node In NodeColl
  if Node.IsVisible then
    Response.Write("<siteMapNode url=""" & Node.Url & """ title=""" & Node.Title & """  description=""" & Node.Title & """ >" & Environment.NewLine)
    Dim SubChildNodes as SPNavigationNodeCollection = Node.Children
    Response.Write(SubChildNodes.Count) 'returns 0 always even though I know theres over 20 nodes in some of the sections
    Dim ChildNode as SPNavigationNode
    For Each ChildNode in SubChildNodes
      if ChildNode.IsVisible then
        Response.Write("<siteMapNode url=""" & ChildNode.Url & """ title=""" & ChildNode.Title & """  description=""" & ChildNode.Title & """ />" & Environment.NewLine)
      End if
    Next
    Response.Write("</siteMapNode>" & Environment.NewLine)
  End If
Next

however whenever I do, it lists the top level navigation nodes but I cannot get the children to be displayed.


I have this same problem, I found the solution as
using (SPSite site = new SPSite("http://server"))
{
    using (SPWeb web = site.OpenWeb())
    {
        SPNavigationNode quicklaunch = web.Navigation.GetNodeById(1025);
        if (quicklaunch != null)
        {
            foreach (SPNavigationNode heading in quicklaunch.Children)
            {
                PrintNode(heading);
            }
        }
    }
}

static void PrintNode(SPNavigationNode node)
{
    foreach (SPNavigationNode item in node.Children)
        PrintNode(item);
}

Make sure you have a SiteMapDataSource associated with your master page quick launch.

I was facing the same issue: I was trying to access the SPWeb.Navigation.Quicklaunch from a web-scoped feature's feature receiver activated from onet.xml, but the SPWeb.Navigation.QuickLaunch.Count was always 0, even though I had definitely added list instances in other features activated previously in the same onet.xml.
The solution for me was to open a new SPSite and a new SPWeb in my feature receiver, after which I was able to access the quick launch items. For example this worked for me:
using (SPSite site = new SPSite("http://yourserver/"))
{
  using (SPweb web = site.OpenWeb("theweb"))
  {
    web.Navigation.QuickLaunch.Count ; // greater than zero

    // manipulate your quick launch here
  }
}

I'm assuming this is because creating the new SPWeb object loads the web's most recent state from database, and the SPWeb passed to my feature receiver didn't represent the latest state. But this is me gues
