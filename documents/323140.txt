System.BadImageFormatException: Could not load file or assembly (from installutil.exe)
.net windows-services x86 64bit x86-64
I am trying to install a Windows service using InstallUtil.exe and am getting the error message

System.BadImageFormatException: Could not load file or assembly '{xxx.exe}' or one of its dependencies. An attempt was made to load a program with an incorrect format.

What gives?

EDIT: (Not by OP) Full message extracted from dup getting way more hits [for googleability]:

C:\Windows\Microsoft.NET\Framework64\v4.0.30319>InstallUtil.exe C:\xxx.exe
      Microsoft (R) .NET Framework Installation utility Version 4.0.30319.1
      Copyright (c) Microsoft Corporation.  All rights reserved.
Exception occurred while initializing the installation:
      System.BadImageFormatException: Could not load file or assembly 'file:///C:\xxx.exe' or one of its dependencies. An attempt was made to load a program with an incorrect format..



Make sure the newest Framework (the one you compiled your app with) is first in the PATH. That solved the problem for me. Found here: http://www.issociate.de/board/post/280574/Installutil_System.BadImageFormatException.html

Some more detail for completeness in case it helps someone...
Note that the most common reason for this exception these days is attempting to load a 32 bit-specific (/platform:x86) DLL into a process that is 64 bit or vice versa (viz. load a 64 bit-specific (/platform:x64) DLL into a process that is 32 bit). If your platform is non-specific (/platform:AnyCpu), this won't arise (assuming no referenced dependencies are of the wrong bitness).
In other words, running:

%windir%\Microsoft.NET\Framework\v2.0.50727\installutil.exe 

or:

%windir%\Microsoft.NET\Framework64\v2.0.50727\installutil.exe 

will not work (substitute in other framework versions: v1.1.4322 (32-bit only, so this issue doesn't arise) and v4.0.30319 as desired in the above).
Obviously, as covered in the other answer, one will also need the .NET version number of the installutil you are running to be >= (preferably =) that of the EXE/DLL file you are running the installer of.
Finally, note that in Visual Studio 2010, the tooling will default to generating x86 binaries (rather than Any CPU as previously).
Complete details of System.BadImageFormatException (saying the only cause is mismatched bittedness is really a gross oversimplification!).
Another reason for a BadImageFormatException under an x64 installer is that in Visual Studio 2010, the default .vdproj Install Project type generates a 32-bit InstallUtilLib shim, even on an x64 system (Search for "64-bit managed custom actions throw a System.BadImageFormatException exception" on the page).

OK, this is the problem I had, and, what fixed it, seems very relevant to the above.
I am using Visual Studio 2010 Express. I wrote a test service that didn't really do anything. It was just practice for the real thing later. 
I wrote the service and tried to install it using installutil.exe and got the following error:

System.BadImageFormatException: Could not load file or assembly '{filename.exe}' or one of its dependencies. An attempt was made to load a program with an incorrect format.

So far the same as the original author. 
Ruben's observation above about the 32 bit output of Visual Studio 2010 was the saviour here. 
I used the 64-bit version of the installutil.exe and sure enough, the output of the Visual Studio 2010 build was 32-bit. Just to add a little extra value here, you can find the 32-bit version of the latest .NET framework and the associated installutil.exe in the C:\Windows\Microsoft.NET\framework folder. Using this version of the installutil.exe fixed my problem; the service installed without a hitch!
I hope this helps someone else out there. 

I think you are using the 64-bit version of the tool to install a 32-bit application. 
I've also faced this issue today and used this Framework path to cater .
C:\Windows\Microsoft.NET\Framework\v4.0.30319
and it should install your 32-bit application just fine.
Thanks
Sachin Kalia

In case it helps anyone, I was able to fix this same exception using this answer to a similar question, but I did not get the exception from using installutil.exe.

I had the same issue.  I using the standard command for execution.  It was calling the X64 ro run against X86 tests.  I needed to specify the X86 and not the X64 version of the nunit-runner.

Summarizing, both the Build and Project\Build\Platform has to be set to x64 in order to successfully install 64 bit service on 64 bit system.
