How to tell if a URL parameter needs to be encoded in Java
java url encoding
I'm writing a Java app that is accepting URL parameter values that may or may not be encoded.  I need an easy way to tell whether or not I need to encode the parameter string.
In other words, I want a function boolean needsEncoding(String param), which will return true if I pass in the String "foo@test.com", and false if I pass in "foo%40test.com".  The problem with this idea is that this is ambiguous.  How would I know whether or not the "%" sign in the latter string should be encoded?  One way to handle this is to modify my contract - require clients to pass in un-encoded strings so that I know I always need to encode them.  Thoughts?


I thought I'd put this as a proposed answer so that people can vote:
One way to handle this is to modify my contract - require clients to pass in un-encoded strings so that I know I always need to encode them.

Signs a string has been URL Encoded:

There are no spaces, but a lot of plus symbols.
All percentage signs are followed by two digits.
There are no characters outside of a..b, A..B, 0..9, ".", "", "-", "", "%" and "+" in it.

However I think that changing the contract is the recommended action here.

how about decoding the string and checking if all the differences between the original and decoded string are valid url entities.

You could use java.net.URLDecoder on the input and see if it changes by comparing the input and output String values.  Looking at the Javadocs for URLDecoder, it describes the business logic it applies on an input String to determine whether or not it requires URL decoding.
If you MUST get a boolean result and do not want to incur the overhead of attempted decoding to get that boolean result, you can always crack open the source code of the URLDecoder class and use the same business logic it uses to determine if URL decoding is necessary.

Here is my normal method of dealing with this. First, since + is an annoying special case, I disallow it as part of the encoding. If they put in a plus, it's a plus, if they want a space, they can press that large bar on the bottom of their keyboard. (And yes, I have made that as part of some contracts). But really, you can explain it away as you working so hard for your client that they don't need to worry about encoding it themselves.
Then I rewrote java.net.URLDecoder.decode to remove the '+' case. (Really just a matter of cutting and pasting into whatever utility class I'm using for that project, and removing ~4 lines).
Then for everything I get, I just run it through the decoder, and then the encoder. This will decode and reencode it if encoded, or encode it if not encoded.  I got this tip from someone on SO years ago, cannot remember who to give proper credit.
So I end up with:
String properlyencodedstring = 
java.net.URLEncoder.encode(LocalDecoder.localdecode(someformdatastring),"UTF-8");

The only time where this may need tweaking would be in the case of data with large groups of urls needing to be entered and processed, is which I switch my assumption, use input type="url"(with some sort of javascript polyfill for old browsers), and preprocess with .replaceAll("+", " "), since there wouldn't be any spaces allowed to be entered in that case. (And in all likelihood, use java.net.URI instead anyway)
