How to use p4merge as the merge/diff tool for Mercurial?
osx configuration mercurial perforce p4merge
Does anyone know how to setup Mercurial to use p4merge as the merge/diff tool on OS X 10.5?


I'm guessing there's a CLI tool for p4merge (which I know nothing about).
I wrote a blog post about using Changes.app, and some other GUI tools with Mercurial: Using Mercurial with GUI Tools.
Basically, you need to know the calling expectations of the CLI tool that loads up the diff tool.  IE, how to make it load data from a particular file, and how to make it wait for exit.  There should be enough info on the post to give you some ideas.

I use the following bit of Python to launch p4merge and use it with git :
#!/usr/bin/python
import sys
import os

os.system('/Applications/p4merge.app/Contents/MacOS/p4merge "%s" "%s"' % (sys.argv[2], sys.argv[5]))

I'm not sure how mercurial looks to launch an external diff tool though ? Hopefully it's as simple as adjusting 2 & 5 in the above line to being the index of the arguments for 'checked in' and 'current working copy'.

Place this into your ~/.hgrc (or, optionally, your Mercurial.ini on Windows):
[merge-tools]
p4.priority = 100
p4.premerge = True  # change this to False if you're don't trust hg's internal merge
p4.executable = /Applications/p4merge.app/Contents/MacOS/p4merge
p4.gui = True
p4.args = $base $local $other $output

Requires Mercurial 1.0 or newer.  Clearly you'll need to update the path to that executable to reflect where you'd got p4merge installed.

I found Ry4an's answer to be a good solution, except for a minor problem, which left p4merge (under mac os) mixing up the command inputs. Do everything described in his answer and add the following line in the [merge-tools] section:
p4.args=$base $local $other $output

This line tells mercurial in which order p4merge takes its arguments.

Maybe because I'm working on Windows, but the proposed solution didn't work for me. Instead, the following does work.
In your ~/.hgrc/ / Mercurial.ini, I applied the following changes:
Enabled "ExtDiff" extension:
[extensions]
hgext.extdiff =

Added P4 extdiff command:
[extdiff]
cmd.p4diff = p4merge

Configured it as the default visual diff tool:
[tortoisehg]
vdiff = p4diff


I am using version 1.0.1 of TortoiseHg and p4merge works out of the box.
Just go to Global Settings -> TortoiseHg and select the following options:

Three-way Merge Tool: p4merge
Visual Diff Tool: p4merge


