Caching Active Directory Data
c# asp.net active-directory
In one of my applications, I am querying active directory to get a list of all users below a given user (using the "Direct Reports" thing). So basically, given the name of the person, it is looked up in AD, then the Direct Reports are read. But then for every direct report, the tool needs to check the direct reports of the direct reports. Or, more abstract: The Tool will use a person as the root of the tree and then walk down the complete tree to get the names of all the leaves (can be several hundred)
Now, my concern is obviously performance, as this needs to be done quite a few times. My idea is to manually cache that (essentially just put all the names in a long string and store that somewhere and update it once a day).
But I just wonder if there is a more elegant way to first get the information and then cache it, possibly using something in the System.DirectoryServices Namespace?


Active Directory is pretty efficient at storing information and the retrieval shouldn't be that much of a performance hit.  If you are really intent on storing the names, you'll probably want to store them in some sort of a tree stucture, so you can see the relationships of all the people.  Depending on how the number of people, you might as well pull all the information you need daily and then query all the requests against your cached copy.  

AD does that sort of caching for you so don't worry about it unless performance becomes a problem.  I have software doing this sort of thing all day long running on a corporate intranet that takes thousands of hits per hour and have never had to tune performance in this area.  

In order to take control over the properties that you want to be cached you can call 'RefreshCache()' passing the properties that you want to hang around:
System.DirectoryServices.DirectoryEntry entry = new System.DirectoryServices.DirectoryEntry();               

// Push the property values from AD back to cache.

entry.RefreshCache(new string[] {"cn", "www" });


Depends on how up to date you want the information to be.  If you must have the very latest data in your report then querying directly from AD is reasonable.  And I agree that AD is quite robust, a typical dedicated AD server is actually very lightly utilised in normal day to day operations but best to check with your IT department / support person.
An alternative is to have a daily script to dump the AD data into a CSV file and/or import it into a SQL database.  (Oracle has a SELECT CONNECT BY feature that can automatically create multi-level hierarchies within a result set.  MSSQL can do a similar thing with a bit of recursion IIRC).
