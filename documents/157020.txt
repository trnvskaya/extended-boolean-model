iSeries SQL Procedure - Check if already exists
sql ibm-midrange
I have an script that falls over if any of the procedures it is trying to create already exists. How can I check/drop if this procedure is already created?


I would guess something along the lines of:
IF EXISTS
(
    SELECT *
    FROM SYSPROCS
    WHERE SPECIFIC_SCHEMA = ???
      AND SPECIFIC_NAME = ???
      AND ROUTINE_SCHEMA = ???
      AND ROUTINE_NAME = ???
)
    DROP PROCEDURE ???

I don't know if you actually need the SPECIFIC_* information or not and I don't know how to handle cases where you have two procedures with the same name but different call signatures, but hopefully this gets you on the right track.

IF  EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[dbo].[Procedure_Name]') AND OBJECTPROPERTY(id,N'IsProcedure') = 1)
DROP PROCEDURE [dbo].[Procedure_Name]

I think this would help you

You might check for existence this way (note - make sure of case):
SELECT *                       
FROM QSYS2/PROCEDURES          
WHERE PROCNAME LIKE 'your-procedure-name'
AND   PROCSCHEMA = 'your-procedure-library'   


DROP PROCEDURE xxx ;
CREATE PROCEDURE XXX
.
.
. ;
Include a DROP PROCEDURE as the first statement in the script. If you run with RUNSQLSTM, use ERRLVL(20) to allow the DROP to fail. If you run through 'Run SQL Scripts', use the 'Ignore "Object not found" on DROP' option.
